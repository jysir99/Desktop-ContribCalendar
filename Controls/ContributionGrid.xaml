<UserControl x:Class="ContribCalendar.Controls.ContributionGrid"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:ContribCalendar.Controls"
             xmlns:converters="clr-namespace:ContribCalendar.Converters"
             mc:Ignorable="d"
             d:DesignHeight="150" d:DesignWidth="750">
    <UserControl.Resources>
        <converters:IntensityColorConverter x:Key="IntensityColorConverter"/>

        <!-- 年份样式 -->
        <Style x:Key="YearTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="Margin" Value="0,1,0,1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#333"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 选中年份样式 -->
        <Style x:Key="SelectedYearTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#0969da"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,1,0,1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <!-- 限制中间部分的宽度为自动适应内容，防止挤占右侧空间 -->
            <ColumnDefinition Width="Auto"/>
            <!-- 右侧年份列表占据剩余空间，方便居中对齐 -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 顶部：月份标签行（可拖动） -->
        <Canvas Grid.Column="1" Grid.Row="0" Name="MonthsPanel" Height="18" MouseLeftButtonDown="TopBar_MouseLeftButtonDown" Background="Transparent"/>

        <!-- 右上：按钮 -->
        <StackPanel Grid.Column="2" Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
            <Button Name="RefreshButton"
                    Width="18" Height="18"
                    Background="Transparent"
                    BorderThickness="0"
                    Cursor="Hand"
                    Margin="0,0,2,0"
                    ToolTip="刷新数据"
                    Click="RefreshButton_Click">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" Padding="2" Cursor="Hand">
                            <Path Data="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"
                                  Fill="#666"
                                  Stretch="Uniform"
                                  Width="12" Height="12"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#20000000"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>

            <Button Name="MenuButton"
                    Width="18" Height="18"
                    Background="Transparent"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="MenuButton_Click">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" Padding="2" Cursor="Hand">
                            <TextBlock Text="&#9776;"
                                       FontFamily="Segoe UI Symbol"
                                       FontSize="12"
                                       Foreground="#666"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#20000000"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </StackPanel>

        <!-- 星期标签 -->
        <Canvas Grid.Column="0" Grid.Row="1" VerticalAlignment="Top" Margin="0,0,2,0" Width="28">
            <TextBlock Text="Mon" FontSize="9" Foreground="#555" Canvas.Top="1"/>
            <TextBlock Text="Wed" FontSize="9" Foreground="#555" Canvas.Top="25"/>
            <TextBlock Text="Fri" FontSize="9" Foreground="#555" Canvas.Top="49"/>
            <TextBlock Text="Sun" FontSize="9" Foreground="#555" Canvas.Top="73"/>
        </Canvas>

        <!-- 贡献格子网格 -->
        <Grid Grid.Column="1" Grid.Row="1" Name="ContributionsGrid"/>

        <!-- 右侧：年份列表与水印 -->
        <Grid Grid.Column="2" Grid.Row="1">
            <StackPanel Name="YearListPanel" Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,15"/>
            <!-- 小水印 -->
            <TextBlock Text="@Jysir"
                       FontSize="9"
                       Foreground="#40000000"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Bottom"
                       Margin="0,0,0,2"
                       IsHitTestVisible="False"/>
        </Grid>
    </Grid>
</UserControl>
