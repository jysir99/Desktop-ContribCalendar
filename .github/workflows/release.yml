name: Build and Release WPF App

on:
  push:
    tags:
      - 'v*' # å½“æ‚¨å‘ GitHub æ¨é€ä»¥ v å¼€å¤´çš„ Tag æ—¶è§¦å‘ï¼ˆä¾‹å¦‚ï¼šv1.0.0ï¼‰

jobs:
  build-and-release:
    runs-on: windows-latest 

    permissions:
      contents: write # å…è®¸åˆ›å»º GitHub Release

    steps:
    - name: æ£€å‡ºä»£ç  (Checkout Code)
      uses: actions/checkout@v4

    - name: å®‰è£… .NET 8 ç¯å¢ƒ
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ç¼–è¯‘ç‹¬ç«‹éƒ¨ç½²ç‰ˆæœ¬ (Self-Contained - è¾ƒå¤§ä½†å…è£…ç¯å¢ƒ)
      run: dotnet publish ContribCalendar.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true -o ./publish_self_contained

    - name: ç¼–è¯‘æ¡†æ¶ä¾èµ–ç‰ˆæœ¬ (Framework-Dependent - å°å·§ä½†éœ€è£…ç¯å¢ƒ)
      run: dotnet publish ContribCalendar.csproj -c Release -r win-x64 --self-contained false -p:PublishSingleFile=true -o ./publish_framework_dependent

    - name: å‹ç¼©æ–‡ä»¶ä¸º ZIP (Compress Output)
      run: |
        Compress-Archive -Path ./publish_self_contained/* -DestinationPath ContribCalendar-Windows-x64-SelfContained.zip
        Compress-Archive -Path ./publish_framework_dependent/* -DestinationPath ContribCalendar-Windows-x64-FrameworkDependent.zip

    - name: ç”Ÿæˆå‘å¸ƒè¯´æ˜ (Generate Release Notes)
      run: |
        $ReleaseNotes = @"
        ## ğŸ‰ è‡ªåŠ¨æ„å»ºç‰ˆæœ¬å‘å¸ƒ (Automated Release)

        è¿™é‡Œæä¾›äº†ä¸¤ä¸ªç‰ˆæœ¬çš„ Windows åº”ç”¨ç¨‹åºä¾›æ‚¨ä¸‹è½½ï¼š

        ### ğŸ“¦ 1. ç‹¬ç«‹è¿è¡Œå¢å¼ºç‰ˆ (Self-Contained)
        **æ–‡ä»¶**: `ContribCalendar-Windows-x64-SelfContained.zip` (è¾ƒå¤§)
        **è¯´æ˜**: å†…ç½®äº†å®Œæ•´çš„ .NET 8 è¿è¡Œç¯å¢ƒã€‚**ä¸‹è½½è§£å‹åç›´æ¥åŒå‡»å³å¯è¿è¡Œ**ï¼Œæ— éœ€åœ¨ç”µè„‘ä¸Šé¢å¤–å®‰è£…ä»»ä½•å¾®è½¯æ¡†æ¶ã€‚é€‚åˆä¸æƒ³æŠ˜è…¾è¿è¡Œç¯å¢ƒçš„ç”¨æˆ·ã€‚

        ### âš¡ 2. è½»é‡æ¡†æ¶ä¾èµ–ç‰ˆ (Framework-Dependent)
        **æ–‡ä»¶**: `ContribCalendar-Windows-x64-FrameworkDependent.zip` (è¾ƒå°, ~4MB)
        **è¯´æ˜**: åŸæ±åŸå‘³çš„å°å·§ç‰ˆæœ¬ã€‚**éœ€è¦æ‚¨çš„ç”µè„‘å·²ç»å®‰è£…äº† [`.NET 8 Desktop Runtime`](https://dotnet.microsoft.com/en-us/download/dotnet/8.0)** æ‰èƒ½è¿è¡Œã€‚å¦‚æœæ‚¨æ‰“ä¸å¼€ï¼Œè¯·ä¸‹è½½å¹¶å®‰è£…ä¸Šè¿°é“¾æ¥ä¸­çš„ "Desktop Runtime"ã€‚é€‚åˆå·²ç»æœ‰ .NET ç¯å¢ƒæˆ–å–œæ¬¢å°ä½“ç§¯è½¯ä»¶çš„ç”¨æˆ·ã€‚

        > âš ï¸ **æ³¨æ„**: ç”±äºæœ¬å·¥å…·é‡‡ç”¨äº† WPF (Windows Presentation Foundation) å¼€å‘åŸç”Ÿæ¡Œé¢ä½“éªŒï¼Œå› æ­¤**ä»…æ”¯æŒ Windows æ“ä½œç³»ç»Ÿ**ï¼Œæ— æ³•è·¨å¹³å°ç”Ÿæˆ macOS æˆ– Linux ç‰ˆæœ¬ã€‚
        "@
        Set-Content -Path release_notes.md -Value $ReleaseNotes -Encoding UTF8

    - name: è‡ªåŠ¨åˆ›å»º Release å¹¶ä¸Šä¼ å‹ç¼©åŒ… (Create GitHub Release)
      uses: softprops/action-gh-release@v2
      with:
        files: |
          ContribCalendar-Windows-x64-SelfContained.zip
          ContribCalendar-Windows-x64-FrameworkDependent.zip
        body_path: release_notes.md
